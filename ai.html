<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="/Favicon.png">
    <title>Endo Prism AI Chat</title>
    <style>
        /* Base layout */
        body {
            margin: 0;
            font-family: Arial, sans-serif;
            background-color: #f0f0f0;
            display: flex;
            flex-direction: column;
            height: 100vh;
            overflow: hidden;
        }

        /* Chat container */
        #chatContainer {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            background: #e5e5e5;
        }

        .message {
            max-width: 80%;
            padding: 10px 15px;
            border-radius: 20px;
            word-wrap: break-word;
            line-height: 1.4;
        }

        .userMessage {
            align-self: flex-end;
            background-color: #007bff;
            color: white;
            border-bottom-right-radius: 0;
        }

        .aiMessage {
            align-self: flex-start;
            background-color: #fff;
            color: #111;
            border-bottom-left-radius: 0;
            white-space: pre-wrap;
        }

        /* Input area fixed at bottom */
        #inputContainer {
            display: flex;
            padding: 10px;
            background: #fff;
            border-top: 1px solid #ccc;
        }

        #userInput {
            flex: 1;
            padding: 10px 15px;
            border-radius: 25px;
            border: 1px solid #ccc;
            outline: none;
            font-size: 16px;
        }

        #sendBtn {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border: none;
            margin-left: 10px;
            background-color: #007bff;
            color: white;
            font-size: 24px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.2s;
        }

        #sendBtn:hover {
            transform: scale(1.1);
        }

        /* iframe preview */
        #previewFrame {
            width: 100%;
            height: 300px;
            border: 1px solid #ccc;
            margin-top: 10px;
            border-radius: 8px;
        }
    </style>
</head>

<body>

    <div id="chatContainer"></div>

    <div id="inputContainer">
          <input id="userInput" placeholder="Ask me to make a website, generate JS/CSS, or answer anything..." />
          <button id="sendBtn">â†’</button>
    </div>

    <script>/* ai_script.js - Endo Prism AI (super-smart website builder, offline)
- Outputs HTML code in chat bubbles
- Detects topics and generates themed content
- Natural-language parsing; ignores filler words
- Differentiates between chat and code requests
- Typewriter effect for AI messages
*/

        (function (window, document) {
            const DEFAULT_PERSONALITY = 'neutral';

            // --- Ensure UI exists ---
            let chatContainer = document.getElementById('chatContainer');
            let userInput = document.getElementById('userInput');
            let sendBtn = document.getElementById('sendBtn');

            function createBaseUI() {
                if (!chatContainer) {
                    chatContainer = document.createElement('div');
                    chatContainer.id = 'chatContainer';
                    Object.assign(chatContainer.style, {
                        position: 'fixed', left: '0', right: '0', top: '0', bottom: '92px',
                        overflowY: 'auto', padding: '18px', boxSizing: 'border-box', background: '#eef0f2'
                    });
                    document.body.appendChild(chatContainer);
                }
                if (!userInput || !sendBtn) {
                    const inputBar = document.createElement('div');
                    inputBar.id = 'inputBar';
                    Object.assign(inputBar.style, {
                        position: 'fixed', left: '0', right: '0', bottom: '0', height: '88px',
                        display: 'flex', alignItems: 'center', gap: '12px', padding: '12px', boxSizing: 'border-box',
                        background: '#fff', borderTop: '1px solid #ddd'
                    });
                    userInput = document.createElement('textarea');
                    userInput.id = 'userInput';
                    Object.assign(userInput.style, {
                        flex: '1', height: '64px', borderRadius: '12px', padding: '12px', fontSize: '15px',
                        border: '1px solid #ccc', resize: 'none', fontFamily: 'Arial'
                    });
                    sendBtn = document.createElement('button');
                    sendBtn.id = 'sendBtn';
                    sendBtn.innerText = 'â†’';
                    Object.assign(sendBtn.style, {
                        width: '56px', height: '56px', borderRadius: '50%', border: 'none', background: '#007bff', color: '#fff',
                        fontSize: '24px', cursor: 'pointer', display: 'flex', alignItems: 'center', justifyContent: 'center'
                    });
                    inputBar.appendChild(userInput);
                    inputBar.appendChild(sendBtn);
                    document.body.appendChild(inputBar);
                }
            }

            createBaseUI();

            // --- Personality ---
            let personality = DEFAULT_PERSONALITY;
            const personalityPanel = document.createElement('div');
            Object.assign(personalityPanel.style, {
                position: 'fixed', right: '16px', top: '16px', zIndex: 9999, background: '#fff', padding: '8px 10px',
                borderRadius: '8px', boxShadow: '0 6px 18px rgba(0,0,0,0.08)', fontFamily: 'Arial', fontSize: '13px'
            });
            personalityPanel.innerHTML = `
    <label style="margin-right:8px;color:#333">Personality</label>
    <select id="endoPersonality">
      <option value="neutral">Neutral & Professional</option>
      <option value="fun">Fun & Friendly</option>
    </select>`;
            document.body.appendChild(personalityPanel);
            const personalitySelect = document.getElementById('endoPersonality');
            personalitySelect.value = personality;
            personalitySelect.addEventListener('change', (e) => { personality = e.target.value; });

            // --- Utilities ---
            const FILLER = new Set(['a', 'the', 'that', 'is', 'would', 'be', 'has', 'for', 'please', 'me', 'make', 'i', 'want', 'with', 'and', 'of', 'to', 'it', 'in', 'on', 'my', 'about', 'so', 'like', 'this']);
            function tokenizeForIntent(input) {
                return input
                    .toLowerCase()
                    .replace(/[^\w\s'-]/g, ' ')
                    .split(/\s+/)
                    .filter(t => t && !FILLER.has(t));
            }
            function nowISO() { return (new Date()).toISOString(); }
            function escapeHtml(s) { return String(s).replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;'); }

            // --- Detect if user is chatting ---
            const CHAT_TRIGGERS = ['hi', 'hello', 'hey', 'thanks', 'thank you', 'bye', 'good morning', 'good evening', 'yo'];
            function isChat(input) {
                const low = input.toLowerCase();
                return CHAT_TRIGGERS.some(trigger => low.includes(trigger));
            }

            // --- Detect website type and topic ---
            function detectTopic(tokens) {
                if (tokens.includes('cat') || tokens.includes('cats')) return 'Cats';
                if (tokens.includes('dog') || tokens.includes('dogs')) return 'Dogs';
                if (tokens.includes('plane') || tokens.includes('aircraft') || tokens.includes('jet')) return 'Planes';
                if (tokens.includes('car') || tokens.includes('cars')) return 'Cars';
                return null;
            }

            function detectSize(tokens) {
                if (tokens.includes('small') || tokens.includes('mini') || tokens.includes('simple')) return 'small';
                if (tokens.includes('big') || tokens.includes('large') || tokens.includes('huge') || tokens.includes('complex')) return 'large';
                return 'medium';
            }

            // --- Typewriter for AI output ---
            function typewriterToChatBlock(text, options = { monospace: true }) {
                const wrap = document.createElement('div');
                wrap.className = 'message aiMessage';
                wrap.style.whiteSpace = 'pre-wrap';
                wrap.style.fontFamily = options.monospace ? 'ui-monospace, SFMono-Regular, Menlo, Monaco, "Roboto Mono", monospace' : 'Arial';
                wrap.style.background = '#fff';
                wrap.style.padding = '12px';
                wrap.style.borderRadius = '12px';
                wrap.style.boxShadow = '0 6px 18px rgba(2,6,23,0.06)';
                wrap.style.marginBottom = '10px';
                chatContainer.appendChild(wrap);
                chatContainer.scrollTop = chatContainer.scrollHeight;
                const speed = 6;
                let i = 0;
                return new Promise(resolve => {
                    const timer = setInterval(() => {
                        let chunk = text.slice(i, i + 5);
                        wrap.textContent += chunk;
                        i += chunk.length;
                        chatContainer.scrollTop = chatContainer.scrollHeight;
                        if (i >= text.length) {
                            clearInterval(timer);
                            resolve(wrap);
                        }
                    }, speed);
                });
            }

            // --- Build super-smart website ---
            function buildWebsiteFromIntent(intent) {
                const topic = intent.topic || "My Website";
                const size = intent.size;
                const lower = topic.toLowerCase();
                let colors = { accent: "#0b1320", bg: "#ffffff", emoji: "ðŸŒ" };
                let facts = [];

                if (lower.includes("cat")) {
                    colors = { accent: "#f5b041", bg: "#fffaf2", emoji: "ðŸ±" };
                    facts = [
                        "Cats sleep for 13â€“16 hours a day â€” thatâ€™s nearly 70% of their lives!",
                        "A group of cats is called a clowder.",
                        "Cats can rotate their ears 180 degrees.",
                        "Domestic cats share 95.6% of their DNA with tigers!"
                    ];
                } else if (lower.includes("dog")) {
                    colors = { accent: "#2b7a78", bg: "#f1fffb", emoji: "ðŸ¶" };
                    facts = [
                        "Dogs have a sense of smell 40x stronger than humans.",
                        "The Basenji is the only dog breed that doesnâ€™t bark.",
                        "Dogs can understand over 150 words and gestures!",
                        "A dogâ€™s nose print is as unique as a human fingerprint."
                    ];
                } else if (lower.includes("plane")) {
                    colors = { accent: "#007bff", bg: "#f5f9ff", emoji: "âœˆï¸" };
                    facts = [
                        "The fastest jet ever built is the SR-71 Blackbird, flying over 2,000 mph.",
                        "Commercial jets fly at about 35,000 feet.",
                        "Wings generate lift because air moves faster over the top surface.",
                        "Pilots use 'rotate' to lift off the runway."
                    ];
                } else if (lower.includes("car")) {
                    colors = { accent: "#b71c1c", bg: "#fff5f5", emoji: "ðŸš—" };
                    facts = [
                        "The first car was invented in 1886 by Karl Benz.",
                        "F1 cars go 0â€“60 mph in under 2 seconds!",
                        "Electric cars use regenerative braking to recharge batteries.",
                        "Average car engines have 4â€“8 cylinders."
                    ];
                } else {
                    facts = [
                        `This is a themed site about ${topic}.`,
                        `Customize it however you like!`,
                        `Try saying â€œmake a website about catsâ€ or â€œabout planes.â€`
                    ];
                }

                const accent = colors.accent;
                const bg = colors.bg;
                const emoji = colors.emoji;
                const factCards = facts.map(f => `<div class="card"><p>${f}</p></div>`).join("\n");

                return `
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>${topic}</title>
<style>
:root{--accent:${accent};--bg:${bg};--muted:#6c757d;}
*{box-sizing:border-box;}
body{margin:0;font-family:'Inter',system-ui,sans-serif;line-height:1.5;background:var(--bg);color:#111;}
.container{max-width:1000px;margin:0 auto;padding:24px;}
header{background:var(--accent);color:white;text-align:center;padding:40px 20px;border-radius:16px;}
header h1{margin:0;font-size:2.5em;}
main{margin-top:32px;}
h2{color:var(--accent);}
.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:16px;margin-top:18px;}
.card{background:white;padding:16px;border-radius:12px;box-shadow:0 4px 10px rgba(0,0,0,0.08);}
footer{text-align:center;color:var(--muted);margin-top:40px;}
</style>
</head>
<body>
<div class="container">
<header>
<h1>${emoji} ${topic}</h1>
<p>Welcome to the world of ${topic.toLowerCase()}!</p>
</header>
<main>
<section>
<h2>Fun Facts ${emoji}</h2>
<div class="grid">
${factCards}
</div>
</section>
</main>
<footer>
<p>Â© 2025 ${topic} â€¢ Generated by Endo Prism AI</p>
</footer>
</div>
</body>
</html>`;
            }

            // --- Process user input ---
            async function processUserInput(rawInput) {
                const userText = String(rawInput || '').trim();
                if (!userText) return;

                // user bubble
                const userMsg = document.createElement('div');
                userMsg.className = 'message userMessage';
                Object.assign(userMsg.style, { alignSelf: 'flex-end', background: '#007bff', color: '#fff', padding: '10px 14px', borderRadius: '14px', fontFamily: 'Arial', maxWidth: '84%' });
                userMsg.textContent = userText;
                chatContainer.appendChild(userMsg);
                chatContainer.scrollTop = chatContainer.scrollHeight;

                // Determine if chat or website
                if (isChat(userText)) {
                    const reply = personality === 'fun' ? "Hey there! ðŸ˜„" : "Hello.";
                    await typewriterToChatBlock(reply, { monospace: false });
                    return;
                }

                // Build intent
                const tokens = tokenizeForIntent(userText);
                const size = detectSize(tokens);
                const topic = detectTopic(tokens) || "My Website";
                const intent = { topic, size, personality };

                // Status message
                const status = document.createElement('div');
                status.className = 'message aiMessage';
                Object.assign(status.style, { background: '#fff', padding: '10px 14px', borderRadius: '12px', boxShadow: '0 6px 18px rgba(2,6,23,0.04)', fontFamily: 'Arial' });
                status.textContent = 'Endo Prism AI is generating your site â€” this may take a moment...';
                chatContainer.appendChild(status);
                chatContainer.scrollTop = chatContainer.scrollHeight;

                await new Promise(r => setTimeout(r, 180));

                const html = buildWebsiteFromIntent(intent);
                status.remove();

                await typewriterToChatBlock(html, { monospace: true });
            }

            // --- Attach events ---
            sendBtn.addEventListener('click', () => { const t = userInput.value; if (!t.trim()) return; userInput.value = ''; processUserInput(t); });
            userInput.addEventListener('keydown', e => {
                if ((e.metaKey || e.ctrlKey) && e.key === 'Enter') { sendBtn.click(); }
                else if (e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); sendBtn.click(); }
            });

            // initial greeting
            (async function greet() {
                const g = personality === 'fun' ? 'Hey! Tell me what website to make â€” I will generate the code.' : 'Hello. Describe the website you want (e.g., "Make a website about cats").';
                await typewriterToChatBlock(g, { monospace: false });
            })();

            // Expose for power-users
            window.EndoPrismAI = { processUserInput, buildWebsiteFromIntent, getPersonality: () => personality, setPersonality: (p) => { personality = p; personalitySelect.value = p; } };

            // ensure message styles
            (function ensureStyles() {
                if (document.getElementById('endoPrismAIStyles')) return;
                const style = document.createElement('style'); style.id = 'endoPrismAIStyles';
                style.textContent = `
      .message{max-width:84%;margin-bottom:12px}
      .aiMessage{align-self:flex-start}
      .userMessage{align-self:flex-end}
      .message pre{white-space:pre-wrap}
    `;
                document.head.appendChild(style);
            })();

        })(window, document);
    </script>
</body>

</html>